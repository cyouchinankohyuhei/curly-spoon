<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>住宅診断カルテ作成システム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #F2EFE9; color: #333333; font-family: 'Noto Serif JP', serif; line-height: 1.7; }
        .item-card { border-bottom: 1px solid #D1CDC7; padding: 1.2rem 0; }
        .advice-box { background-color: #EAE5DD; border-radius: 4px; font-size: 0.7rem; color: #666; margin-top: 0.5rem; padding: 0.6rem; border-left: 2px solid #888; }
        .camera-label { display: inline-flex; align-items: center; background: #333; color: white; padding: 6px 12px; border-radius: 2px; font-size: 10px; cursor: pointer; margin-top: 10px; }
        .preview-img { width: 50px; height: 50px; object-fit: cover; border-radius: 2px; margin-top: 5px; border: 1px solid #ccc; }
        
        /* カルテ・ビジネス仕様 */
        .karte-border { border: 2px solid #333; padding: 25px; background: #fff; position: relative; }
        .stamp-box { width: 65px; height: 65px; border: 1px solid #c2410c; color: #c2410c; display: flex; align-items: center; justify-content: center; font-size: 10px; border-radius: 50%; transform: rotate(-15deg); font-weight: bold; border-width: 2px; }

        input[type="checkbox"] {
            appearance: none; width: 20px; height: 20px; border: 1px solid #888; border-radius: 50%;
            cursor: pointer; position: relative; vertical-align: middle; flex-shrink: 0;
        }
        input[type="checkbox"]:checked { background-color: #888; }
        input[type="checkbox"]:checked::after {
            content: ''; position: absolute; top: 4px; left: 4px; width: 10px; height: 10px; border-radius: 50%; background: #F2EFE9;
        }
    </style>
</head>
<body class="p-6 md:p-12 pb-40">

    <header class="max-w-3xl mx-auto mb-12">
        <h1 class="text-2xl md:text-3xl tracking-widest leading-snug font-bold">住宅診断カルテ作成<br>鶴岡空き家内見ナビ</h1>
        <div class="flex gap-2 mt-4">
            <span class="text-[9px] bg-zinc-800 text-white px-2 py-1">二級建築士</span>
            <span class="text-[9px] bg-zinc-800 text-white px-2 py-1">電気工事士</span>
            <span class="text-[9px] bg-zinc-800 text-white px-2 py-1">ガス・設備士</span>
        </div>
    </header>

    <main class="max-w-3xl mx-auto space-y-16">

        <section>
            <h2 class="text-xl mb-4 border-b border-black pb-2 font-bold text-slate-700">01 外部環境診断（立地・外装）</h2>
            <div class="space-y-1">
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m1" data-label="道路幅員" data-pro="0" data-diy="0"><label for="m1" class="ml-4 text-sm font-semibold">前面道路の幅員（4m以上・除雪車進入可否）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m2" data-label="駐車場拡幅" data-pro="300000" data-diy="50000"><label for="m2" class="ml-4 text-sm font-semibold">駐車場の拡幅可能性（並列駐車の可否）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m3" data-label="災害リスク" data-pro="0" data-diy="0"><label for="m3" class="ml-4 text-sm font-semibold">ハザードマップ該当状況（浸水・土砂）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m4" data-label="庭木管理" data-pro="100000" data-diy="20000"><label for="m4" class="ml-4 text-sm font-semibold">外構・庭木の管理・伐採の必要性</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m5" data-label="外壁劣化" data-pro="800000" data-diy="150000"><label for="m5" class="ml-4 text-sm font-semibold">外壁のひび割れ・塗装の劣化（チョーキング）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m6" data-label="境界杭" data-pro="0" data-diy="0"><label for="m6" class="ml-4 text-sm font-semibold">隣地境界杭の目視確認</label></div></div>
            </div>
            <label class="camera-label"><span>📷 写真を記録</span><input type="file" accept="image/*" capture="environment" class="hidden" onchange="preview(this)"></label>
            <div class="flex gap-2 mt-2 preview-container"></div>
        </section>

        <section>
            <h2 class="text-xl mb-4 border-b border-black pb-2 font-bold text-red-900">02 構造健全性診断（雨漏り等）</h2>
            <div class="space-y-1">
                <div class="item-card flex flex-col">
                    <div class="flex items-start"><input type="checkbox" id="m7" data-label="雨漏り跡" data-pro="500000" data-diy="50000"><label for="m7" class="ml-4 text-sm font-bold text-red-800">雨漏りの形跡（天井・小屋裏のシミ）</label></div>
                    <div class="advice-box">建築士所見：構造材の腐朽リスク。早期治療を推奨。</div>
                </div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m8" data-label="基礎クラック" data-pro="200000" data-diy="30000"><label for="m8" class="ml-4 text-sm font-semibold">基礎の構造的なひび割れ（0.5mm超）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m9" data-label="床不陸" data-pro="300000" data-diy="50000"><label for="m9" class="ml-4 text-sm font-semibold">床のたわみ・沈み（土台の健全性）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m10" data-label="残置物多量" data-pro="300000" data-diy="80000"><label for="m10" class="ml-4 text-sm font-semibold">残置物による家財処分の必要性</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m11" data-label="建具歪み" data-pro="150000" data-diy="20000"><label for="m11" class="ml-4 text-sm font-semibold">サッシ・建具の開閉不全（歪み）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m12" data-label="床下環境" data-pro="100000" data-diy="10000"><label for="m12" class="ml-4 text-sm font-semibold">床下の湿気・カビ・腐朽臭の有無</label></div></div>
            </div>
            <label class="camera-label"><span>📷 写真を記録</span><input type="file" accept="image/*" capture="environment" class="hidden" onchange="preview(this)"></label>
            <div class="flex gap-2 mt-2 preview-container"></div>
        </section>

        <section>
            <h2 class="text-xl mb-4 border-b border-black pb-2 font-bold text-blue-900">03 雪国適応性診断（鶴岡特有）</h2>
            <div class="space-y-1">
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m13" data-label="落雪スペース" data-pro="200000" data-diy="30000"><label for="m13" class="ml-4 text-sm font-semibold">落雪スペースの確保と隣地への影響</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m14" data-label="融雪稼働" data-pro="150000" data-diy="20000"><label for="m14" class="ml-4 text-sm font-semibold">既存融雪設備の稼働状況</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m15" data-label="雪害破損" data-pro="100000" data-diy="20000"><label for="m15" class="ml-4 text-sm font-semibold">雪害による軒先・雨樋の変形</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m16" data-label="水抜き栓故障" data-pro="50000" data-diy="5000"><label for="m16" class="ml-4 text-sm font-semibold text-blue-800 font-bold">水抜き栓の動作（凍結予防の生命線）</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m17" data-label="風除・気密" data-pro="150000" data-diy="50000"><label for="m17" class="ml-4 text-sm font-semibold">北西風に対する気密性・風除室状況</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m18" data-label="換気口高" data-pro="0" data-diy="10000"><label for="m18" class="ml-4 text-sm font-semibold">積雪時を考慮した床下換気口の高さ</label></div></div>
            </div>
            <label class="camera-label"><span>📷 写真を記録</span><input type="file" accept="image/*" capture="environment" class="hidden" onchange="preview(this)"></label>
            <div class="flex gap-2 mt-2 preview-container"></div>
        </section>

        <section>
            <h2 class="text-xl mb-4 border-b border-black pb-2 font-bold text-green-900">04 設備インフラ診断（水・電・ガス）</h2>
            <div class="space-y-1">
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m19" data-label="浴室改修" data-pro="1000000" data-diy="150000"><label for="m19" class="ml-4 text-sm font-semibold">浴室：タイルからユニットバスへの更新</label></div></div>
                <div class="item-card flex flex-col">
                    <div class="flex items-start"><input type="checkbox" id="m20" data-label="単相3線欠如" data-pro="120000" data-diy="0"><label for="m20" class="ml-4 text-sm font-bold text-red-800 underline">電気：単相3線式への引込工事の要否</label></div>
                    <div class="advice-box">電気工事士所見：エアコン利用等に必須。DIY不可。</div>
                </div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m21" data-label="給湯器更新" data-pro="200000" data-diy="30000"><label for="m21" class="ml-4 text-sm font-bold text-red-800">給湯器の更新・熱源種の適合性</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m22" data-label="下水・浄化槽" data-pro="300000" data-diy="50000"><label for="m22" class="ml-4 text-sm font-semibold">トイレ・排水：浄化槽または下水接続</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m23" data-label="分電盤更新" data-pro="60000" data-diy="10000"><label for="m23" class="ml-4 text-sm font-semibold">分電盤の老朽度・空き回路容量</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m24" data-label="配管漏水" data-pro="100000" data-diy="10000"><label for="m24" class="ml-4 text-sm font-semibold">給水管の赤サビ・漏水・水栓の固着</label></div></div>
            </div>
            <label class="camera-label"><span>📷 写真を記録</span><input type="file" accept="image/*" capture="environment" class="hidden" onchange="preview(this)"></label>
            <div class="flex gap-2 mt-2 preview-container"></div>
        </section>

        <section class="pb-20">
            <h2 class="text-xl mb-4 border-b border-black pb-2 font-bold text-orange-800">05 資産価値・特記事項</h2>
            <div class="space-y-1">
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m25" data-label="良質古材" data-pro="-200000" data-diy="-50000"><label for="m25" class="ml-4 text-sm font-semibold text-orange-700">保存価値の高い古材（梁・柱）の現存</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m26" data-label="アンティーク" data-pro="0" data-diy="0"><label for="m26" class="ml-4 text-sm font-semibold text-orange-700">意匠建具・型板ガラスの活用価値</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m27" data-label="活用空間" data-pro="0" data-diy="0"><label for="m27" class="ml-4 text-sm font-semibold">蔵・土間等の多目的活用ポテンシャル</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m28" data-label="熱取得" data-pro="0" data-diy="0"><label for="m28" class="ml-4 text-sm font-semibold text-orange-700">冬場の日射熱取得の優位性</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m29" data-label="通信網" data-pro="50000" data-diy="10000"><label for="m29" class="ml-4 text-sm font-semibold">光ファイバー引込等の適合性</label></div></div>
                <div class="item-card flex flex-col"><div class="flex items-start"><input type="checkbox" id="m30" data-label="バリアフリー" data-pro="100000" data-diy="30000"><label for="m30" class="ml-4 text-sm font-semibold">生活動線の改修容易性</label></div></div>
                <div class="item-card flex flex-col border-none"><div class="flex items-start"><input type="checkbox" id="m31" data-label="佇まい" data-pro="0" data-diy="0"><label for="m31" class="ml-4 text-sm font-bold italic">全体の佇まいと空間の直感性</label></div></div>
            </div>
            <label class="camera-label"><span>📷 お宝を記録</span><input type="file" accept="image/*" capture="environment" class="hidden" onchange="preview(this)"></label>
            <div class="flex gap-2 mt-2 preview-container"></div>
        </section>

    </main>

    <div class="fixed bottom-0 left-0 w-full p-8 bg-[#F2EFE9]/95 backdrop-blur-md flex justify-center border-t border-zinc-200 gap-4">
        <button onclick="calculate()" class="bg-black text-white px-10 py-5 tracking-widest text-xs hover:bg-zinc-800 transition shadow-2xl font-bold uppercase">診断カルテを発行する</button>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-zinc-900/95 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div id="pdf-area" class="karte-border max-w-lg w-full shadow-2xl my-auto">
            <div class="flex justify-between items-start border-b-2 border-zinc-800 pb-4 mb-6">
                <div>
                    <h2 class="text-2xl font-bold tracking-tighter">住宅診断カルテ</h2>
                    <p class="text-[9px] opacity-70">Case Record: Tsuruoka Akiya Professional Audit</p>
                </div>
                <div class="text-right">
                    <div id="reportDate" class="text-[10px] mb-1"></div>
                    <div class="stamp-box">住宅の<br>主治医</div>
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-4 text-[9px] border-b border-zinc-100 pb-4">
                <div><span class="opacity-60">診断物件：</span>鶴岡市内 空き家</div>
                <div><span class="opacity-60">技術担当：</span>二級建築士 / 電気工事士 / 設備士</div>
            </div>

            <div class="space-y-4 mb-6">
                <div class="p-4 bg-zinc-50 border border-zinc-200">
                    <p class="text-[8px] font-bold mb-1 text-zinc-400 uppercase tracking-widest">処方：概算改修コスト</p>
                    <div class="flex justify-between items-baseline mb-1">
                        <span class="text-xs">業者フルリノベーション</span>
                        <span id="proCost" class="text-xl font-bold">¥0</span>
                    </div>
                    <div class="flex justify-between items-baseline text-orange-800 font-bold border-t border-zinc-200 pt-1">
                        <span class="text-xs">DIY最適化（コスト抑制案）</span>
                        <span id="diyCost" class="text-2xl font-bold">¥0</span>
                    </div>
                </div>

                <div id="checked-items-summary" class="text-[9px] text-zinc-600 leading-relaxed bg-white p-3 border border-dotted border-zinc-300">
                    </div>
            </div>

            <div id="finalPhotos" class="flex flex-wrap gap-1 mb-6"></div>

            <div class="border-t-2 border-zinc-800 pt-4 mt-4">
                <p class="text-[9px] font-bold mb-2 uppercase tracking-widest">主治医によるアフターケアのご案内</p>
                <p class="text-[9px] leading-relaxed text-zinc-600 mb-4 italic">
                    本カルテは、建築士・電気工事士・設備士の視点から作成されました。特に水道・ガス・電気のライフライン改修や、雪国特有の設備不具合については、当方にて直接施工・アフターフォローが可能です。
                </p>
                <div class="bg-black text-white p-3 text-center text-[10px] font-bold tracking-widest uppercase">
                    施工・詳細見積りのご相談はLINEまで
                </div>
            </div>

            <div class="flex flex-col gap-3 mt-6 no-pdf">
                <button onclick="savePDF()" class="bg-zinc-800 text-white py-4 text-xs tracking-widest font-bold">PDFカルテを保存</button>
                <button onclick="sendLine()" class="bg-[#06C755] text-white py-4 text-xs tracking-widest font-bold">LINE経由で専門相談</button>
                <button onclick="location.reload()" class="text-[10px] tracking-widest opacity-40 underline mt-2 text-center">再診断</button>
            </div>
        </div>
    </div>

    <script>
        function preview(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                const container = input.parentElement.nextElementSibling;
                reader.onload = e => {
                    const img = document.createElement('img');
                    img.src = e.target.result; img.className = 'preview-img';
                    container.appendChild(img);
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        let reportMessage = "";

        function calculate() {
            let totalPro = 0; let totalDiy = 0;
            let checks = [];
            document.querySelectorAll('input:checked').forEach(c => {
                totalPro += parseInt(c.dataset.pro || 0);
                totalDiy += parseInt(c.dataset.diy || 0);
                checks.push(c.dataset.label);
            });

            document.getElementById('proCost').innerText = "¥" + totalPro.toLocaleString();
            document.getElementById('diyCost').innerText = "¥" + totalDiy.toLocaleString();
            document.getElementById('reportDate').innerText = "診断日：" + new Date().toLocaleDateString();
            
            const summary = document.getElementById('checked-items-summary');
            summary.innerHTML = "<strong>指摘・チェック所見:</strong><br>" + (checks.length ? checks.join(' / ') : "特筆すべき異常なし");

            reportMessage = `【住宅診断カルテ】\n業者概算: ¥${totalPro.toLocaleString()}\nDIY併用: ¥${totalDiy.toLocaleString()}\n\n診断所見:\n${checks.join('\n')}\n\n※設備・ライフラインの改修相談可能です。`;

            const photoBox = document.getElementById('finalPhotos');
            photoBox.innerHTML = "";
            document.querySelectorAll('.preview-img').forEach(img => {
                const clone = img.cloneNode();
                clone.style.width = "55px"; clone.style.height = "55px";
                photoBox.appendChild(clone);
            });

            document.getElementById('modal').classList.remove('hidden');
        }

        function savePDF() {
            const btns = document.querySelector('.no-pdf');
            btns.style.display = 'none';
            const element = document.getElementById('pdf-area');
            const opt = {
                margin: 5, filename: '住宅診断カルテ_鶴岡.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().set(opt).from(element).save().then(() => {
                btns.style.display = 'flex';
            });
        }

        function sendLine() {
            const lineID = "@YOUR_ID"; 
            navigator.clipboard.writeText(reportMessage).then(() => {
                alert("カルテ結果をコピーしました。LINEに貼り付けてご相談ください。");
                window.location.href = `https://line.me/R/ti/p/${lineID}`;
            });
        }
    </script>
</body>
</html>
